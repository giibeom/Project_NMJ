<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qna.project.nmj.beans.dao.MemberDAO">
	<!-- 회원가입 -->
	<!-- 회원공통 -->
	<insert id="insertMember" flushCache="true" parameterType="qna.project.nmj.beans.MemberDTO">
		INSERT INTO NMJ_member (mb_id, mb_pw, mb_name, mb_tel, mb_email, mb_type)
		VALUES (#{dto.mb_id}, #{dto.mb_pw}, #{dto.mb_name}, #{dto.mb_tel}, #{dto.mb_email}, #{dto.mb_type});
	</insert>
	<!-- 매장회원 정보등록 -->
	<insert id="insertStore" flushCache="true" parameterType="qna.project.nmj.beans.StoreDTO">
		INSERT INTO NMJ_store
		(store_name, store_address, store_regNum, store_type, store_dtype, store_tel, store_hours, store_content)
		VALUES
		(#{param1}, #{param2}, #{param3}, #{param4}, #{param5}, #{param6}, #{param7}, #{param8});
	</insert>
	
	
	<!-- 아이디 중복검사 -->
	<select id="checkOverId" parameterType="String" resultType="int">
		SELECT count(*) FROM NMJ_member WHERE mb_id = #{mb_id};
	</select>
	
	<!-- 아이디 찾기 -->
	<select id="selectId" resultType="qna.project.nmj.beans.MemberDTO">
		SELECT mb_name, mb_email, mb_id
		FROM NMJ_member
		WHERE mb_name = #{param1}
		AND mb_email = #{param2};
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="selectPw" resultType="qna.project.nmj.beans.MemberDTO">
		SELECT mb_id, mb_name, mb_email, mb_pw
		FROM NMJ_member
		WHERE mb_id = #{param1}
		AND mb_name = #{param2}
		AND mb_email = #{param3};
	</select>

	<!-- 임시비밀번호로 업데이트 -->
	<update id="updatePw" flushCache="true" parameterType="qna.project.nmj.beans.MemberDTO">
		UPDATE NMJ_member SET mb_pw = #{param1}
		WHERE mb_id = #{param2};
	</update>
	
	
	<!-- 페이지네이션 -->
	<!-- 글 목록 전체 개수 가져오기 -->
	<select id="selectStoreCount" resultType="int">
		SELECT COUNT(*) FROM NMJ_store NATURAL JOIN NMJ_storeDType WHERE store_type = #{param1};
	</select>
	
	
	<!-- from 부터 row 만큼 SELECT : LIMIT 은 0 부터 시작 주의! -->
	<!-- 매장 찾기 페이지(default) -->
	<select id="selectStore" resultType="qna.project.nmj.beans.FindStoreDTO">
		SELECT
			*
		FROM NMJ_store NATURAL JOIN NMJ_storeDType
		WHERE store_type = #{param1} order by store_uid asc limit 0, 9;
	</select>
	<select id="selectStoreType" resultType="qna.project.nmj.beans.StoreTypeDTO">
		SELECT * FROM NMJ_storeDType where store_type = #{param1};
	</select>
	
	<select id="page" resultType="qna.project.nmj.beans.FindStoreDTO">
		SELECT
			*
		FROM NMJ_store NATURAL JOIN NMJ_storeDType
		WHERE store_type = #{param1} order by store_uid asc limit #{fromRow}, #{writePages};
	</select>
	
	
	
	
	<!-- 매장 상세페이지 -->
	<select id="selectStoreDetail" resultType="qna.project.nmj.beans.StoreDetailDTO">
		select 
			*,
			round((store_ratings / store_rateCount), 1) totalAvg
		from nmj_store
		where store_uid = #{param1};
	</select>	
	
	<select id="StoreDetailRestSeat" resultType="qna.project.nmj.beans.StoreDetailDTO">
		select 
			count(space_name) count
		from nmj_space
		where space_empty = 1 and store_uid = #{param1};
	</select>
	
	
	<select id="selectFood" resultType="qna.project.nmj.beans.StoreDetailDTO">
		select * from NMJ_food where store_uid = #{param1};	
	</select>
	
	
	
<!-- 메인 페이지 -->
	
	<!-- 평점순 추천 가게(핫플레이스) -->
	<select id="selectHotPlaceNol" resultType="qna.project.nmj.beans.MainDTO">
		SELECT *,
		round((store_ratings / store_rateCount), 1) as totalAvg
		from NMJ_store
		WHERE store_type = 1
		ORDER BY round((store_ratings / store_rateCount), 1) DESC limit 3;
	</select>
	<select id="selectHotPlaceMuk" resultType="qna.project.nmj.beans.MainDTO">
		SELECT *,
		round((store_ratings / store_rateCount), 1) as totalAvg
		from NMJ_store
		WHERE store_type = 2
		ORDER BY round((store_ratings / store_rateCount), 1) DESC limit 3;
	</select>
	<select id="selectHotPlaceJa" resultType="qna.project.nmj.beans.MainDTO">
		SELECT *,
		round((store_ratings / store_rateCount), 1) as totalAvg
		from NMJ_store
		WHERE store_type = 3
		ORDER BY round((store_ratings / store_rateCount), 1) DESC limit 3;
	</select>
	
	
	<!-- 커뮤니티 --> <!-- 회원이름, 내용, 작성일, 조회수 (조회수 순으로 5개 출력) -->
	<select id="selectCommunity" resultType="qna.project.nmj.beans.MainDTO">
		SELECT * from nmj_review NATURAL JOIN nmj_member
		ORDER BY review_viewCount DESC limit 10;
	</select>
	
	
	
	
	
</mapper>








