<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="qna.project.nmj.beans.dao.AdminDAO">

	<select id="selectAllMember" resultType="qna.project.nmj.beans.MemberDTO">
		SELECT * FROM NMJ_member WHERE mb_type = 1 ORDER BY mb_uid DESC
	</select>
	
	<update id="deleteMember" flushCache="true">
		UPDATE NMJ_member 
		SET mb_type = -1 
		WHERE mb_uid = #{param1}
	</update>
	
	<select id="selectAllStoreMember" resultType="qna.project.nmj.beans.StoreMemberDTO">
		SELECT a.*, b.store_type, b.store_name FROM NMJ_member a INNER JOIN NMJ_store b ON a.mb_uid = b.mb_uid WHERE a.mb_type = 2 ORDER BY mb_uid DESC
	</select>
	
	<select id="selectMemberByUid" 
 		resultType="qna.project.nmj.beans.MemberDTO">
 		SELECT * FROM NMJ_member
		WHERE mb_uid = #{param1}
 	</select>
 	
 	<select id="selectStoreByUid" 
 		resultType="qna.project.nmj.beans.StoreDTO">
 		SELECT * FROM NMJ_store
		WHERE mb_uid = #{param1}
 	</select>
 	
 	<select id="selectAllReview" resultType="qna.project.nmj.beans.ReviewJoinDTO">
		SELECT a.*, b.store_type, b.store_name, c.mb_id 
		FROM NMJ_review a 
		JOIN NMJ_store b ON a.store_uid = b.store_uid 
		JOIN NMJ_member c ON a.mb_uid = c.mb_uid 
		ORDER BY review_uid DESC
	</select>
	
	<update id="deleteReview" flushCache="true">
		UPDATE NMJ_review 
		SET review_ban = "1
		WHERE review_uid = #{param1}
	</update>
	
	<select id="selectReviewByUid" 
 		resultType="qna.project.nmj.beans.ReviewJoinDTO">
 		SELECT a.*, b.store_type, b.store_name, c.mb_id 
		FROM NMJ_review a 
		JOIN NMJ_store b ON a.store_uid = b.store_uid 
		JOIN NMJ_member c ON a.mb_uid = c.mb_uid 
		WHERE review_uid = #{param1}
 	</select>
 	
 	<update id="increaseViewCount">
 		 UPDATE NMJ_review SET review_viewCount = review_viewCount + 1 
 		 WHERE review_uid = #{param1}
 	</update>
 	
 	<select id="searchMemberByName" 
 		resultType="qna.project.nmj.beans.MemberDTO">
 		SELECT * FROM NMJ_member 
 		WHERE mb_name LIKE CONCAT('%',#{search},'%') and mb_type = 1
 	</select>
 	
 	<select id="searchMemberById" 
 		resultType="qna.project.nmj.beans.MemberDTO">
 		SELECT * FROM NMJ_member WHERE mb_id LIKE CONCAT('%',#{search},'%') and mb_type = 1
 	</select>
 	
 	<select id="searchStoreByName" 
 		resultType="qna.project.nmj.beans.StoreMemberDTO">
 		SELECT a.*, b.store_type, b.store_name FROM NMJ_member a INNER JOIN NMJ_store b ON a.mb_uid = b.mb_uid WHERE a.mb_type = 2
 		and store_name LIKE CONCAT('%',#{search},'%')
 	</select>
 	
 	<select id="searchStoreById" 
 		resultType="qna.project.nmj.beans.StoreMemberDTO">
 		SELECT a.*, b.store_type, b.store_name FROM NMJ_member a INNER JOIN NMJ_store b ON a.mb_uid = b.mb_uid WHERE a.mb_type = 2
 		and mb_id LIKE CONCAT('%',#{search},'%')
 	</select>
 	
 	<select id="searchReviewByContent" 
 		resultType="qna.project.nmj.beans.ReviewJoinDTO">
 		SELECT a.*, b.store_type, b.store_name, c.mb_id 
		FROM NMJ_review a 
		JOIN NMJ_store b ON a.store_uid = b.store_uid 
		JOIN NMJ_member c ON a.mb_uid = c.mb_uid
 		WHERE review_content LIKE CONCAT('%',#{search},'%')
 	</select>
 	
 	<select id="searchReviewById" 
 		resultType="qna.project.nmj.beans.ReviewJoinDTO">
 		SELECT a.*, b.store_type, b.store_name, c.mb_id 
		FROM NMJ_review a 
		JOIN NMJ_store b ON a.store_uid = b.store_uid 
		JOIN NMJ_member c ON a.mb_uid = c.mb_uid
 		WHERE c.mb_id LIKE CONCAT('%',#{search},'%')
 	</select>
 	
 	<select id="selectNStore" 
 		resultType="qna.project.nmj.beans.StoreMemberDTO">
 		SELECT a.*, b.store_type, b.store_name FROM NMJ_member a INNER JOIN NMJ_store b ON a.mb_uid = b.mb_uid WHERE a.mb_type = 2
 		and store_type = 1
 	</select>
 	
 	<select id="selectMStore" 
 		resultType="qna.project.nmj.beans.StoreMemberDTO">
 		SELECT a.*, b.store_type, b.store_name FROM NMJ_member a INNER JOIN NMJ_store b ON a.mb_uid = b.mb_uid WHERE a.mb_type = 2
 		and store_type = 2
 	</select>
 	
 	<select id="selectJStore" 
 		resultType="qna.project.nmj.beans.StoreMemberDTO">
 		SELECT a.*, b.store_type, b.store_name FROM NMJ_member a INNER JOIN NMJ_store b ON a.mb_uid = b.mb_uid WHERE a.mb_type = 2
 		and store_type = 3
 	</select>
 	
 	<select id="selectAllRequest" resultType="qna.project.nmj.beans.RequestDTO">
		SELECT * FROM NMJ_request WHERE request_check != 2 ORDER BY request_uid DESC
	</select>
	
	<update id="rejectRequest">
 		 UPDATE NMJ_request SET request_check = 2
 		 WHERE request_uid = #{param1}
 	</update>
 	
 	<update id="solveRequest">
 		 UPDATE NMJ_request SET request_check = 1
 		 WHERE request_uid = #{param1}
 	</update>
 	
 	<update id="acceptStore">
 		 UPDATE NMJ_member SET mb_type = 2
 		 WHERE mb_uid = #{param1}
 	</update>
 	
 	<select id="selectStoreMemberByUid" 
 		resultType="qna.project.nmj.beans.StoreMemberDTO">
 		SELECT a.*, b.mb_uid
 		FROM NMJ_store a JOIN NMJ_member b ON a.mb_uid = b.mb_uid 
		WHERE store_uid = #{param1}
 	</select>

</mapper>
